{% include multilingual.html %}
{% include head.html %}
{% include header.html %}

<div id="main-content" class="container reportingstatus">

  <div id="main-content" class="container search-results" role="main">
   <div id='mydiv'>
        <button class='gen_btn'>Download All Metadata</button>
    </div>
  </div>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.1.0/papaparse.js"></script>
    <script>
          $(document).ready(function () {
            $('button').click(function () {
                fetch("https://dawncomer.github.io/open-sdg-data-starter/meta/all.json")
                    .then(response => response.json())
                    .then(function (data) {
                        var metadataArray = Object.values(data);
                        var sortedArray = metadataArray.sort((a,b)=>a.indicator_sort_order.replace(/-/g,"").localeCompare(b.indicator_sort_order.replace(/-/g,"")));
                        var csv = Papa.unparse({ fields: ["title", "sdg_goal", "permalink", "layout", "indicator_name", "indicator", "indicator_sort_order", "target", "target_id", "indicator_definition", "un_designated_tier", "un_custodian_agency", "goal_meta_link", "goal_meta_link_text", "national_indicator_available", "national_indicator_description", "national_geographical_coverage", "computation_units", "computation_definitions", "computation_calculations", "data_disaggregation_information", "wccd_iso_37120_alignment", "comments_limitations", "national_data_update_url", "national_data_update_url_text", "national_metadata_update_url", "national_metadata_update_url_text", "tags", "reporting_status", "data_non_statistical", "data_footnote", "data_geocode_regex", "data_keywords", "data_show_map", "graph_type", "graph_title", "source_active_1", "source_organisation_1", "source_periodicity_1", "source_earliest_available_1", "source_geographical_coverage_1", "source_url_1", "source_url_text_1", "source_release_date_1", "source_next_release_1", "source_statistical_classification_1", "source_contact_1", "source_other_info_1", "source_active_2", "source_organisation_2", "source_periodicity_2", "source_earliest_available_2", "source_geographical_coverage_2", "source_url_2", "source_url_text_2", "source_release_date_2", "source_next_release_2", "source_statistical_classification_2", "source_contact_2", "source_other_info_2", "source_active_3", "source_organisation_3", "source_periodicity_3", "source_earliest_available_3", "source_geographical_coverage_3", "source_url_3", "source_url_text_3", "source_release_date_3", "source_next_release_3", "source_statistical_classification_3", "source_contact_3", "source_other_info_3", "source_active_4", "source_organisation_4", "source_periodicity_4", "source_earliest_available_4", "source_geographical_coverage_4", "source_url_4", "source_url_text_4", "source_release_date_4", "source_next_release_4", "source_statistical_classification_4", "source_contact_4", "source_other_info_4", "source_active_5", "source_organisation_5", "source_periodicity_5", "source_earliest_available_5", "source_geographical_coverage_5", "source_url_5", "source_url_text_5", "source_release_date_5", "source_next_release_5", "source_statistical_classification_5", "source_contact_5", "source_other_info_5", "source_active_6", "source_organisation_6", "source_periodicity_6", "source_earliest_available_6", "source_geographical_coverage_6", "source_url_6", "source_url_text_6", "source_release_date_6", "source_next_release_6", "source_statistical_classification_6", "source_contact_6", "source_other_info_6"], data: JSON.stringify(sortedArray) });
                        var blob = new Blob([csv]);
                        if (window.navigator.msSaveOrOpenBlob)
                            window.navigator.msSaveBlob(blob, "SDGmetadata.csv");
                        else {
                            var a = window.document.createElement("a");
                            a.href = window.URL.createObjectURL(blob, { type: "text/plain" });
                            a.download = "SDGmetadata.csv";
                            document.body.appendChild(a);
                            a.click();
                            document.body.removeChild(a);
                        }
                    })
                    .catch(function (error) {
                        console.log(error);
                    });
            });
        });
    </script>
  
  <h1>{{ t.status.reporting_status }}</h1>

  {%- assign overall = site.data.reporting.overall -%}
  <div class="goal goal-overall">
    <div class="details">
      <h2 class="status-goal">
        {{ t.status.overall_reporting_status }} <span class="total"><span>{{ overall.totals.total }}</span>
          {{ t.general.indicators | downcase }}</span>
      </h2>
      <div class="summary">
        <div class="statuses">
          {%- for status in overall.statuses -%}
          <div>
            <span
              class="status {{ status.status | slugify }}">{{ status.count }}</span><strong>{{ status.translation_key | t }}</strong><span
              class="value">{{ status.percentage }}%</span>
          </div>
          {%- endfor -%}

          <br style="clear:both;">
        </div>
      </div>
      <div class="goal-stats">
        {%- for status in overall.statuses -%}
        {% assign status_count_precise = status.count | times: 1.0 %}
        {% assign overall_total_precise = overall.totals.total  | times: 1.0 %}
        {% assign percentage_precise = status_count_precise | divided_by: overall_total_precise | times: 100 %}
        <span class="{{ status.status | slugify }}" style="width:{{ percentage_precise }}%"
          title="{{ status.translation_key | t }}: {{ status.percentage }}%"></span>
        {%- endfor -%}
      </div>

    </div>
    <!--</li>-->
    <br style="clear:both;">
  </div>
  
  
  <h2>{{ t.status.status_by_goal }}</h2>

  {%- for goalreport in site.data.reporting.goals -%}
  {%- assign goal_number = goalreport.goal  | downcase -%}
  {%- assign goal_short_key = goal_number | append: '-short' -%}
  {%- assign goal_short = t.global_goals[goal_short_key] -%}
  <div class="goal">
    <div class="frame">
      <a href="{{ site.baseurl }}{{ baseurl_folder }}/{{ goal_number }}/">
        <img src="{{ site.goal_image_base }}/{{ current_language }}/{{ goal_number }}.png"
          alt="{{ goal_short }} - {{ t.general.goal }} {{ goal_number }}" width="100" height="100" />
      </a>
    </div>
    <div class="details">
      <h3 class="status-goal">
        <a href="{{ site.baseurl }}{{ baseurl_folder }}/{{ goal_number }}/">{{ goal_short }}</a>
        <span class="total">{{ goalreport.totals.total }}<span></span> {{ t.general.indicators | downcase }}</span>
      </h3>
      <div class="summary">
        <div class="statuses">
          {%- for status in goalreport.statuses -%}
          <div>
            <span
              class="status {{ status.status | slugify }}">{{ status.count }}</span><strong>{{ status.translation_key | t }}</strong><span
              class="value">{{ status.percentage }}%</span>
          </div>
          {%- endfor -%}
          <br style="clear:both;">
        </div>
      </div>
      <div class="goal-stats">
        {%- for status in goalreport.statuses -%}
        {% assign status_count_precise = status.count | times: 1.0 %}
        {% assign goalreport_total_precise = goalreport.totals.total  | times: 1.0 %}
        {% assign percentage_precise = status_count_precise | divided_by: goalreport_total_precise | times: 100 %}<span
          class="{{ status.status | slugify }}" style="width:{{ percentage_precise }}%"
          title="{{ status.translation_key | t }}: {{ status.percentage }}%"></span>
        {%- endfor -%}
      </div>
      <div class="divider">
      </div>
    </div>
    <!--</li>-->
    <br style="clear:both;">
  </div>
  {%- endfor -%}

  <!--{{ content }}-->

</div>
{% include footer.html %}
